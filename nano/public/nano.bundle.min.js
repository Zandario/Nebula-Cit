function NanoStateClass(){}function NanoStateDefaultClass(){this.key="default",NanoStateManager.addState(this)}var NanoUtility=function(){var e={};return{init:function(){var t=$("body");e=t.data("urlParameters")},generateHref:function(t){var a="?";for(var n in e)e.hasOwnProperty(n)&&("?"!==a&&(a+=";"),a+=n+"="+e[n]);for(var n in t)t.hasOwnProperty(n)&&("?"!==a&&(a+=";"),a+=n+"="+t[n]);return a}}}();"undefined"==typeof jQuery&&alert("ERROR: Javascript library failed to load!"),"undefined"==typeof doT&&alert("ERROR: Template engine failed to load!"),function(){var e=window.alert;window.alert=function(t){window.location="byond://?nano_err="+encodeURIComponent(t),e(t)}}(),$(document).ready(function(){NanoUtility.init(),NanoStateManager.init(),NanoTemplate.init()}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,a=Number(arguments[1])||0;for(a=a<0?Math.ceil(a):Math.floor(a),a<0&&(a+=t);a<t;a++)if(a in this&&this[a]===e)return a;return-1}),String.prototype.format||(String.prototype.format=function(e){var t=this;return t.replace(String.prototype.format.regex,function(t){var a,n=parseInt(t.substring(1,t.length-1));return a=n>=0?e[n]:-1===n?"{":-2===n?"}":"",a})},String.prototype.format.regex=new RegExp("{-?[0-9]+}","g")),Object.size=function(e){var t=0;for(var a in e)e.hasOwnProperty(a)&&t++;return t},window.console||(window.console={log:function(e){return!1}}),String.prototype.toTitleCase=function(){var e=/^(a|an|and|as|at|but|by|en|for|if|in|of|on|or|the|to|vs?\.?|via)$/i;return this.replace(/([^\W_]+[^\s-]*) */g,function(t,a,n,o){return n>0&&n+a.length!==o.length&&a.search(e)>-1&&":"!==o.charAt(n-2)&&o.charAt(n-1).search(/[^\s-]/)<0?t.toLowerCase():a.substr(1).search(/[A-Z]|\../)>-1?t:t.charAt(0).toUpperCase()+t.substr(1)})},$.ajaxSetup({cache:!1}),Function.prototype.inheritsFrom=function(e){return this.prototype=new e,this.prototype.constructor=this,this.prototype.parent=e.prototype,this},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.ckey||(String.prototype.ckey=function(){return this.replace(/\W/g,"").toLowerCase()});var NanoTemplate=function(){var e={},t="",a={},n={},o={},r=function(){e=$("body").data("templateData"),t=$("body").data("initialData").config.templateFileName,null==e&&alert("Error: Template data did not load correctly."),i()},i=function(){$.when($.ajax({url:t,cache:!1,dataType:"json"})).done(function(t){for(var a in e){var n=t[e[a]];n+='<div class="clearBoth"></div>';try{NanoTemplate.addTemplate(a,n)}catch(t){return void alert("ERROR: Loading template "+a+"("+e[a]+") failed with error: "+t.message)}delete e[a]}$(document).trigger("templatesLoaded")}).fail(function(){alert("ERROR: Failed to locate or parse templates file.")})},s=function(){for(var t in a)try{n[t]=doT.template(a[t],null,a)}catch(a){alert('ERROR: Compiling template key "'+t+'" ("'+e[t]+'") failed with error: '+a)}};return{init:function(){r()},addTemplate:function(e,t){a[e]=t},templateExists:function(e){return a.hasOwnProperty(e)},parse:function(e,t){if(!n.hasOwnProperty(e)||!n[e]){if(!a.hasOwnProperty(e))return alert('ERROR: Template "'+e+'" does not exist in _compiledTemplates!'),"<h2>Template error (does not exist)</h2>";s()}return"function"!=typeof n[e]?"<h2>Template error (failed to compile)</h2>":n[e].call(this,t.data,t.config,o)},addHelper:function(e,t){jQuery.isFunction(t)?o[e]=t:alert("NanoTemplate.addHelper failed to add "+e+" as it is not a function.")},addHelpers:function(e){for(var t in e)e.hasOwnProperty(t)&&NanoTemplate.addHelper(t,e[t])},removeHelper:function(e){helpers.hasOwnProperty(e)&&delete o[e]}}}();NanoStateManager=function(){var e=!1,t=null,a={},n={},o={},r=null,i=function(){t=$("body").data("initialData"),null!=t&&t.hasOwnProperty("config")&&t.hasOwnProperty("data")||alert("Error: Initial data did not load correctly.");var a="default";t.config.hasOwnProperty("stateKey")&&t.config.stateKey&&(a=t.config.stateKey.toLowerCase()),NanoStateManager.setCurrentState(a),$(document).on("templatesLoaded",function(){l(t),e=!0})},s=function(a){var n;try{n=jQuery.parseJSON(a)}catch(e){return void alert("recieveUpdateData failed. <br>Error name: "+e.name+"<br>Error Message: "+e.message)}n.hasOwnProperty("data")||(t&&t.hasOwnProperty("data")?n.data=t.data:n.data={}),e?l(n):t=n},l=function(e){null!=r&&(e=r.onBeforeUpdate(e),!1!==e?(t=e,r.onUpdate(t),r.onAfterUpdate(t)):alert("data is false, return"))},c=function(e,t){for(var a in e)e.hasOwnProperty(a)&&jQuery.isFunction(e[a])&&(t=e[a].call(this,t));return t};return{init:function(){i()},receiveUpdateData:function(e){s(e)},addBeforeUpdateCallback:function(e,t){a[e]=t},addBeforeUpdateCallbacks:function(e){for(var t in e)e.hasOwnProperty(t)&&NanoStateManager.addBeforeUpdateCallback(t,e[t])},removeBeforeUpdateCallback:function(e){a.hasOwnProperty(e)&&delete a[e]},executeBeforeUpdateCallbacks:function(e){return c(a,e)},addAfterUpdateCallback:function(e,t){n[e]=t},addAfterUpdateCallbacks:function(e){for(var t in e)e.hasOwnProperty(t)&&NanoStateManager.addAfterUpdateCallback(t,e[t])},removeAfterUpdateCallback:function(e){n.hasOwnProperty(e)&&delete n[e]},executeAfterUpdateCallbacks:function(e){return c(n,e)},addState:function(e){e instanceof NanoStateClass?e.key?o[e.key]=e:alert("ERROR: Attempted to add a state with an invalid stateKey"):alert("ERROR: Attempted to add a state which is not instanceof NanoStateClass")},setCurrentState:function(e){if(void 0===e||!e)return alert("ERROR: No state key was passed!"),!1;if(!o.hasOwnProperty(e))return alert("ERROR: Attempted to set a current state which does not exist: "+e),!1;var t=r;return r=o[e],null!=t&&t.onRemove(r),r.onAdd(t),!0},getCurrentState:function(){return r}}}(),NanoStateClass.prototype.key=null,NanoStateClass.prototype.layoutRendered=!1,NanoStateClass.prototype.contentRendered=!1,NanoStateClass.prototype.mapInitialised=!1,NanoStateClass.prototype.isCurrent=function(){return NanoStateManager.getCurrentState()==this},NanoStateClass.prototype.onAdd=function(e){NanoBaseCallbacks.addCallbacks(),NanoBaseHelpers.addHelpers()},NanoStateClass.prototype.onRemove=function(e){NanoBaseCallbacks.removeCallbacks(),NanoBaseHelpers.removeHelpers()},NanoStateClass.prototype.onBeforeUpdate=function(e){return e=NanoStateManager.executeBeforeUpdateCallbacks(e),e},NanoStateClass.prototype.onUpdate=function(e){try{(!this.layoutRendered||e.config.hasOwnProperty("autoUpdateLayout")&&e.config.autoUpdateLayout)&&($("#uiLayout").html(NanoTemplate.parse("layout",e)),this.layoutRendered=!0),(!this.contentRendered||e.config.hasOwnProperty("autoUpdateContent")&&e.config.autoUpdateContent)&&($("#uiContent").html(NanoTemplate.parse("main",e)),NanoTemplate.templateExists("layoutHeader")&&$("#uiHeaderContent").html(NanoTemplate.parse("layoutHeader",e)),this.contentRendered=!0),NanoTemplate.templateExists("mapContent")&&(this.mapInitialised||($("#uiMap").draggable(),$("#uiMapTooltip").off("click").on("click",function(e){e.preventDefault(),$(this).fadeOut(400)}),this.mapInitialised=!0),$("#uiMapContent").html(NanoTemplate.parse("mapContent",e)),e.config.hasOwnProperty("showMap")&&e.config.showMap?($("#uiContent").addClass("hidden"),$("#uiMapWrapper").removeClass("hidden")):($("#uiMapWrapper").addClass("hidden"),$("#uiContent").removeClass("hidden"))),NanoTemplate.templateExists("mapHeader")&&$("#uiMapHeader").html(NanoTemplate.parse("mapHeader",e)),NanoTemplate.templateExists("mapFooter")&&$("#uiMapFooter").html(NanoTemplate.parse("mapFooter",e))}catch(e){return void alert("ERROR: An error occurred while rendering the UI: "+e.message)}},NanoStateClass.prototype.onAfterUpdate=function(e){NanoStateManager.executeAfterUpdateCallbacks(e)},NanoStateClass.prototype.alertText=function(e){alert(e)},NanoStateDefaultClass.inheritsFrom(NanoStateClass);var NanoStateDefault=new NanoStateDefaultClass;NanoBaseCallbacks=function(){var e=!0,t={},a={status:function(t){var a;return 2==t.config.status?(a="icon24 uiStatusGood",$(".linkActive").removeClass("inactive")):1==t.config.status?(a="icon24 uiStatusAverage",$(".linkActive").addClass("inactive")):(a="icon24 uiStatusBad",$(".linkActive").addClass("inactive")),$("#uiStatusIcon").attr("class",a),$(".linkActive").stopTime("linkPending"),$(".linkActive").removeClass("linkPending"),$(".linkActive").off("click").on("click",function(a){a.preventDefault();var n=$(this).data("href");null!=n&&e&&(e=!1,$("body").oneTime(300,"enableClick",function(){e=!0}),2==t.config.status&&$(this).oneTime(300,"linkPending",function(){$(this).addClass("linkPending")}),window.location.href=n)}),t},nanomap:function(e){return $(".mapIcon").off("mouseenter mouseleave").on("mouseenter",function(e){$("#uiMapTooltip").html($(this).children(".tooltip").html()).show().stopTime().oneTime(5e3,"hideTooltip",function(){$(this).fadeOut(500)})}),$(".zoomLink").off("click").on("click",function(e){e.preventDefault();var t=$(this).data("zoomLevel"),a=$("#uiMap"),n=a.width()*t,o=a.height()*t;a.css({zoom:t,left:"50%",top:"50%",marginLeft:"-"+Math.floor(n/2)+"px",marginTop:"-"+Math.floor(o/2)+"px"})}),$("#uiMapImage").attr("src",e.config.mapName+"-"+e.config.mapZLevel+".png"),e}};return{addCallbacks:function(){NanoStateManager.addBeforeUpdateCallbacks(t),NanoStateManager.addAfterUpdateCallbacks(a)},removeCallbacks:function(){for(var e in t)t.hasOwnProperty(e)&&NanoStateManager.removeBeforeUpdateCallback(e);for(var e in a)a.hasOwnProperty(e)&&NanoStateManager.removeAfterUpdateCallback(e)}}}(),NanoBaseHelpers=function(){var e={syndicateMode:function(){return $("body").css("background-color","#330404"),$("body").css("background-image","url('uiBackground-Syndicate.png')"),$("body").css("background-position","50% 0"),$("body").css("background-repeat","repeat"),$("body").css("color","#ff0000"),$("hr").css("background-color","#551414"),$("a").css("background","#551414"),$("a:link").css("background","#551414"),$("a:visited").css("background","#551414"),$("a:active").css("background","#551414"),$("linkOn").css("background","#551414"),$("linkOff").css("background","#551414"),$("input").css("background","#551414"),$("a:hover").css("color","#551414"),$("a.white").css("color","#551414"),$("a.white:link").css("color","#551414"),$("a.white:visited").css("color","#551414"),$("a.white:active").css("color","#551414"),$("a.white:hover").css("background","#551414"),$("linkOn").css("background","#771414"),$("a.linkOn:link").css("background","#771414"),$("a.linkOn:visited").css("background","#771414"),$("a.linkOn:active").css("background","#771414"),$("a.linkOn:hover").css("background","#771414"),$("statusDisplay").css("border","1px solid #551414"),$("block").css("border","1px solid #551414"),$("progressFill").css("background","#551414"),$("statusDisplay").css("border","1px solid #551414"),$("itemLabelNarrow").css("color","#ff0000"),$("itemLabel").css("color","#ff0000"),$("itemLabelWide").css("color","#ff0000"),$("itemLabelWider").css("color","#ff0000"),$("itemLabelWidest").css("color","#ff0000"),$("link").css("border","1px solid #ff0000"),$("linkOn").css("border","1px solid #ff0000"),$("linkOff").css("border","1px solid #ff0000"),$("selected").css("border","1px solid #ff0000"),$("disabled").css("border","1px solid #ff0000"),$("yellowButton").css("border","1px solid #ff0000"),$("redButton").css("border","1px solid #ff0000"),$("link").css("background","#330000"),$("linkOn").css("background","#330000"),$("linkOff").css("background","#330000"),$("selected").css("background","#330000"),$("disabled").css("background","#330000"),$("yellowButton").css("background","#330000"),$("redButton").css("background","#330000"),$(".average").css("color","#ff0000"),$("#uiTitleFluff").css("background-image","url('uiTitleFluff-Syndicate.png')"),$("#uiTitleFluff").css("background-position","50% 50%"),$("#uiTitleFluff").css("background-repeat","no-repeat"),""},link:function(e,t,a,n,o,r){var i="",s="noIcon";void 0!==t&&t&&(i='<div class="uiLinkPendingIcon"></div><div class="uiIcon16 icon-'+t+'"></div>',s=e?"hasIcon":"onlyIcon"),void 0!==o&&o||(o="link");var l="";return void 0!==r&&r&&(l='id="'+r+'"'),void 0!==n&&n?'<div unselectable="on" class="link '+s+" "+o+" "+n+'" '+l+">"+i+e+"</div>":'<div unselectable="on" class="linkActive '+s+" "+o+'" data-href="'+NanoUtility.generateHref(a)+'" '+l+">"+i+e+"</div>"},round:function(e){return Math.round(e)},fixed:function(e){return Math.round(10*e)/10},floor:function(e){return Math.floor(e)},ceil:function(e){return Math.ceil(e)},string:function(){if(0==arguments.length)return"";if(1==arguments.length)return arguments[0];if(arguments.length>1){stringArgs=[];for(var e=1;e<arguments.length;e++)stringArgs.push(arguments[e]);return arguments[0].format(stringArgs)}return""},formatNumber:function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},displayBar:function(e,t,a,n,o,r,i,s){t<a?e<t?e=t:e>a&&(e=a):e>t?e=t:e<a&&(e=a),void 0!==n&&n||(n=""),void 0!==o&&o||(o=""),void 0!==r&&r||(r=""),i=void 0!==i&&i?"height":"width";var l=Math.round((e-t)/(a-t)*100);return'<div id="displayBar'+s+'" class="displayBar'+r+" "+n+'"><div id="displayBar'+s+'Fill" class="displayBar'+r+"Fill "+n+'" style="'+i+": "+l+'%;"></div><div id="displayBar'+s+'Text" class="displayBar'+r+"Text "+n+'">'+o+"</div></div>"},displayDNABlocks:function(e,t,a,n,o){if(!e)return'<div class="notice">Please place a valid subject into the DNA modifier.</div>';var r=e.split(""),i='<div class="dnaBlock"><div class="link dnaBlockNumber">1</div>',s=1,l=1;for(index in r)if(r.hasOwnProperty(index)&&"object"!=typeof r[index]){var c;c="UI"==o.toUpperCase()?{selectUIBlock:s,selectUISubblock:l}:{selectSEBlock:s,selectSESubblock:l};var d="linkActive";s==t&&l==a&&(d="selected"),i+='<div class="link '+d+' dnaSubBlock" data-href="'+NanoUtility.generateHref(c)+'" id="dnaBlock'+index+'">'+r[index]+"</div>",index++,index%n==0&&index<r.length?(s++,l=1,i+='</div><div class="dnaBlock"><div class="link dnaBlockNumber">'+s+"</div>"):l++}return i+="</div>",i},byondTimeOfDay:function e(){return void 0===e.midnight&&(e.midnight=(new Date).setUTCHours(0,0,0,0)),(new Date-e.midnight)/100}};return{addHelpers:function(){NanoTemplate.addHelpers(e)},removeHelpers:function(){for(var t in e)e.hasOwnProperty(t)&&NanoTemplate.removeHelper(t)}}}();